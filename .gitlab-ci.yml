stages:
    - build
    - publish
    
build:
  stage: build
  except:
    - schedules
  script:
    # Usually the application is compiled here
    - echo "Demo" > Demo.txt
  artifacts:
    paths:
      - "./*"

on-schedule:
  stage: build
  image: 
    name: alpine/git
    entrypoint: [""]
  only:
    - schedules
  script:
    - git config user.email "${GITLAB_USER_EMAIL}"
    - git config user.name "${GITLAB_USER_NAME}"
    - git remote add demo-tag-origin https://oauth2:${GITLAB_ACCESS_TOKEN}@gitlab.com/${CI_PROJECT_PATH}
    - git tag -a "nightly-$(date +%Y-%m-%d)" -m "Auto-Release"
    - git push demo-tag-origin "nightly-$(date +%Y-%m-%d)"
    
publish:
    image: inetprocess/gitlab-release
    stage: publish
    only:
        - tags
    except:
        - schedules
    dependencies: 
        - build
    script:
        - gitlab-release --message 'Automatic release' ./Demo.txt
